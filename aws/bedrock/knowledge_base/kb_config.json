{
  "name": "trading-bot-knowledge-base",
  "description": "Knowledge base for SPY Futures trading patterns and historical trade data",
  "roleArn": "${BedrockKnowledgeBaseRoleArn}",
  "knowledgeBaseConfiguration": {
    "type": "VECTOR",
    "vectorKnowledgeBaseConfiguration": {
      "embeddingModelArn": "arn:aws:bedrock:us-east-1::foundation-model/amazon.titan-embed-text-v2:0",
      "embeddingModelConfiguration": {
        "bedrockEmbeddingModelConfiguration": {
          "dimensions": 1536,
          "normalize": true
        }
      }
    }
  },
  "storageConfiguration": {
    "type": "OPENSEARCH_SERVERLESS",
    "opensearchServerlessConfiguration": {
      "collectionArn": "${OpenSearchCollectionArn}",
      "vectorIndexName": "trading-patterns-index",
      "fieldMapping": {
        "vectorField": "embedding",
        "textField": "text",
        "metadataField": "metadata"
      }
    }
  },
  "dataSource": {
    "name": "structured-trade-data",
    "description": "Structured trade data from S3 /structured/ prefix",
    "dataSourceConfiguration": {
      "type": "S3",
      "s3Configuration": {
        "bucketArn": "${S3BucketArn}",
        "inclusionPrefixes": [
          "structured/",
          "kb/patterns/",
          "features/"
        ]
      }
    },
    "vectorIngestionConfiguration": {
      "chunkingConfiguration": {
        "chunkingStrategy": "HIERARCHICAL",
        "hierarchicalChunkingConfiguration": {
          "levelConfigurations": [
            {
              "maxTokens": 8192
            },
            {
              "maxTokens": 2048
            },
            {
              "maxTokens": 512
            }
          ],
          "overlapTokens": 100
        }
      },
      "parsingConfiguration": {
        "parsingStrategy": "BEDROCK_FOUNDATION_MODEL",
        "bedrockFoundationModelConfiguration": {
          "modelArn": "arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-5-haiku-20241022-v1:0",
          "parsingPrompt": "Extract structured trading data with the following schema:\n- timestamp, symbol, action, price, quantity\n- technical_indicators: {rsi, macd, atr, ema_20}\n- market_context: {trend, volatility, pdh_delta, pdl_delta}\n- outcome: WIN|LOSS\n- pnl: float"
        }
      }
    }
  },
  "tags": {
    "Project": "TradingBot",
    "Component": "KnowledgeBase"
  }
}
