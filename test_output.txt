============================= test session starts ==============================
platform darwin -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0
rootdir: /Users/svss/Documents/code/MyTrader
plugins: mock-3.15.1, anyio-4.11.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 2 items

tests/test_dashboard_api.py 2025-11-26 12:11:40.514 | INFO     | dashboard.backend.dashboard_api:get_detailed_orders:1123 - ðŸ“¥ Got 1 orders from database
2025-11-26 12:11:40.514 | INFO     | dashboard.backend.dashboard_api:get_detailed_orders:1128 - Processing order 123
2025-11-26 12:11:40.515 | INFO     | dashboard.backend.dashboard_api:get_detailed_orders:1195 - ðŸ“Š Returning 1 orders from SQLite database
.2025-11-26 12:11:40.516 | ERROR    | dashboard.backend.dashboard_api:analyze_performance:1878 - Error generating analysis: 'filled_quantity'
Response error: {"detail":"'filled_quantity'"}
F

=================================== FAILURES ===================================
___________________________ test_analyze_performance ___________________________

mock_order_tracker = <MagicMock name='OrderTracker' id='4984649104'>
mock_bedrock = <MagicMock name='BedrockClient' id='4984906112'>
mock_settings = <MagicMock name='load_settings' id='4984910192'>

    def test_analyze_performance(mock_order_tracker, mock_bedrock, mock_settings):
        # Setup mock data
        tracker_instance = mock_order_tracker.return_value
        tracker_instance.get_all_orders.return_value = [
            {
                'order_id': 123,
                'timestamp': datetime.now().isoformat(),
                'symbol': 'ES',
                'action': 'BUY',
                'status': 'Filled',
                'calculated_pnl': 100.0,
                'rationale': 'Bullish',
                'market_regime': 'TRENDING'
            }
        ]
    
        bedrock_instance = mock_bedrock.return_value
        bedrock_instance.generate_text.return_value = "Great performance today!"
    
        # Make request
        response = client.post(
            "/api/analysis/performance",
            json={"period": "today"}
        )
    
        if response.status_code != 200:
            print(f"Response error: {response.text}")
    
        # Verify response
>       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_dashboard_api.py:98: AssertionError
=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/eventkit/util.py:21
  /Users/svss/Documents/code/MyTrader/.venv/lib/python3.12/site-packages/eventkit/util.py:21: DeprecationWarning: There is no current event loop
    return asyncio.get_event_loop_policy().get_event_loop()

<frozen importlib._bootstrap>:488
  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute

<frozen importlib._bootstrap>:488
  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute

<frozen importlib._bootstrap>:488
  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type swigvarlink has no __module__ attribute

dashboard/backend/dashboard_api.py:2637
  /Users/svss/Documents/code/MyTrader/dashboard/backend/dashboard_api.py:2637: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.12/site-packages/fastapi/applications.py:4575
.venv/lib/python3.12/site-packages/fastapi/applications.py:4575
  /Users/svss/Documents/code/MyTrader/.venv/lib/python3.12/site-packages/fastapi/applications.py:4575: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

dashboard/backend/dashboard_api.py:2657
  /Users/svss/Documents/code/MyTrader/dashboard/backend/dashboard_api.py:2657: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_dashboard_api.py::test_analyze_performance - assert 500 == 200
=================== 1 failed, 1 passed, 8 warnings in 1.59s ====================
